# ðŸ›  Refactoring the carousel

The carousel is more complicated to refactor than both the off-canvas menu and the modal window. We'll walk through how to refactor the carousel together.

Once again here are the best practices:

1. Write declarative code
2. Functions should have one purpose
3. Avoid global variables
4. Reduce state changes
5. Write pure functions

## The refactor

One of the first things we can do is to name the callbacks for our event listeners. Let's start the callbacks for next button's event listener and prev button's event listener since they're quite similar.

```js
const moveToNextSlide = e => {
  // Stuff that went in nextButton's event listener
}

const moveToPreviousSlide = e => {
  // Stuff that went in prevButton's event listener
}

nextButton.addEventListener('click', e => moveToNextSlide)
prevButton.addEventListener('click', e => moveToPreviousSlide)
```

We can look at `moveToNextSlide` and `moveToPreviousSlide` next. Notice the amount of similarities between these two functions:

```js
const moveToNextSlide = e => {
  // 1. Get current slide
  // 2. Get next slide
  // 3. Move to next slide
  // 4. Update arrows
  // 5. Update dots
}

const moveToPreviousSlide = e => {
  // 1. Get current slide
  // 2. Get prev slide
  // 3. Move to prev slide
  // 4. Update arrows
  // 5. Update dots
}
```

Here, we can see two things.

First, comments 3, 4, and 5 are the same. That means we can try to group each of them into a function of their own.

Second, comments 3, 4, and 5 change the external state. We want to reduce external state changes, so we'll change them at the end.

Let's work on 3â€”moving to the next/previous slideâ€”first.

## moveToSlide

The code we have looks like this:

```js
// From nextSlide
const amountToMove = nextSlide.style.left
track.style.transform = 'translateX(-' + amountToMove + ')'
currentSlide.classList.remove('is-selected')
nextSlide.classList.add('is-selected')

// From prevSlide
const amountToMove = prevSlide.style.left
track.style.transform = 'translateX(-' + amountToMove + ')'
currentSlide.classList.remove('is-selected')
prevSlide.classList.add('is-selected')
```

They're almost exactly the same. The only difference is between `nextSlide` or `prevSlide`. In this case, we can create a function called `moveToSlide` that takes in both a current and `targetSlide`. `targetSlide` can be `nextSlide` or `previousSlide`.

```js
const moveToSlide = (currentSlide, targetSlide) => {
  const amountToMove = targetSlide.style.left
  track.style.transform = 'translateX(-' + amountToMove + ')'
  currentSlide.classList.remove('is-selected')
  targetSlide.classList.add('is-selected')
}

// In moveToNextSlide
moveToSlide(currentSlide, nextSlide)

// In moveToPrevSlide
moveToSlide(currentSlide, previousSlide)
```

Next, we'll look at point 4, the code to update arrows.

## Looking at the code to update arrows

Here's what we have so far:

```js
// In moveToNextSlide
prevButton.classList.remove('is-hidden')
const isFinalSlide = !nextSlide.nextElementSibling
if (isFinalSlide) {
  nextButton.classList.add('is-hidden')
}

// In moveToPrevSlide
nextButton.classList.remove('is-hidden')
const isFirstSlide = !prevSlide.previousElementSibling
if (isFirstSlide) {
  prevButton.classList.add('is-hidden')
}
```

At first glance, we cannot really see an easy way to refactor these two code into a single functionâ€”they're totally different!

We don't want to force things since it seems hard to refactor them into a single function. We'll move on ahead, work on the rest, and see if we can refactor this part again later.

## updateDots

The code to update the status of dots is similar in both `moveToNextSlide` and `moveToPrevSlide`.

```js
// In moveToNextSlide
const currentDot = dotsContainer.querySelector('.is-selected')
const nextDot = currentDot.nextElementSibling
currentDot.classList.remove('is-selected')
nextDot.classList.add('is-selected')

// In moveToPrevSlide
const currentDot = dotsContainer.querySelector('.is-selected')
const prevDot = currentDot.previousElementSibling
currentDot.classList.remove('is-selected')
prevDot.classList.add('is-selected')
```

- Create function for event handler
- - Reuse lessons from previous refactoring (Most of them)
- Come back and look at the difference later.

1. Carousel is more complicated than both Off canvas and modal
  1. We'll have a harder time refactoring it
  2. But we'll be able to see from the code, that the quality increased.
  3. Can read and maintain better.
  4. Let's begin
2. The best practices
  1. Once again, let's list out the best practices
  2. Write declarative code
  2. Functions should have one purpose
  3. Avoid global variables
  4. Reduce state changes
3. Applying the best practices
  1. We can start by trying to write declarative code.
  2. From previous lessons
    1. know we can refactor the event listeners
    2. extract them first
    3. nextSlide, previousSlide, setSlide
    4.
