# Sanitize your output

Hackers can exploit your website to attack users if you're not careful. They do it through a method called cross-site scripting (XSS).

XSS basically means the attacker gets your website to run their JavaScript. When they run their JavaScript, they can do a lot of harm. They can even use your site to steal your user's username and passwords.

To prevent XSS attacks, you need to prevent other people from running JavaScript in your website.

To prevent people from running JavaScript in your website, you need to sanitize your output.

## How people can run JavaScript on your website

Attackers can run JavaScript on your website when you accidentally insert their JavaScript into the DOM.

They can send you JavaScript without your knowledge through two main ways.

1. Through the URL
2. Through a text field

Let's go through an example and see how it works.

Let's say you have a form with a text field and a submit button.

When the user submits the form, you reproduce what is written in the form.

Here's the HTML:

```html
<form action="#">
  <label for="text">Text</label>
  <input type="text" id="text" name="text">
  <button type="submit">Submit</button>
</form>
<div class="output"></div>
```

And the JavaScript

```js
const form = document.querySelector('form')
const output = document.querySelector('.output')

form.addEventListener('submit', event => {
  event.preventDefault()
  const input = event.target.querySelector('input')
  const value = input.value.trim()

  output.innerHTML = value
})
```

<figure>
  <img src="/images/2018/input.gif" alt="">
  <figcaption></figcaption>
</figure>

JavaScript can be inserted in many ways. One common way is through an attribute. If the attacker uses an attribute, the the value for the attribute is usually written in JavaScript. The value for this attribute is written in JavaScript.

Here's an example:

```html
<img src="x" onerror=alert("HACKED!")>
```

If you add this HTML into the text box, you'll immediately see an alert that says "Hacked!".

<figure>
  <img src="/images/2018/" alt="">
  <figcaption></figcaption>
</figure>

What happens is:

1. JavaScript adds the `<img>` tag into the DOM.
2. The `<img>` tags tries to load the image from "x". This fails because x doesn't exist.
3. When the loading fails, an `error` event will occur.
4. The `onerror` attribute handles the `error` event. This runs the JavaScript.

## Sanitizing your output

If you walk into a hospital, you'll see little bottles of hand sanitizers. Doctors and nurses always wash their hands with hand sanitizers after touching a patient.

Why do they do this?

Germs, bacteria, and viruses from a patient may hop onto a doctor or a nurse who is checking on the patient. These germs can infect the doctor or the nurse if they're not careful.

Even if the doctor or the nurse doesn't get infected, the germs hanging onto the doctor or nurse may infect another patient.

That's why doctors and nurses wash their hand with the sanitizers.

Here, sanitizing the output means to remove ways that enables other people from running JavaScript on our site.

There are two ways to sanitize our output:

1. Use `textContent`
2. Use a library

### Using textContent

`textContent` can only output text. If you use `textContent`, you won't generate any HTML.

```js
form.addEventListener('submit', event => {
  // ...
  output.textContent = value
})
```

<figure>
  <img src="/images/2018/" alt="">
  <figcaption></figcaption>
</figure>

If you need to write HTML, you'd want to use a library instead.

### Using a library

There are many sanitizer libraries on the internet. One example is [DOMPurify](https://github.com/cure53/DOMPurify).

Before you use DOMPurify, you need to include the library before your JavaScript file. The process looks like this:

```html
<!-- Link to DOMPurify -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/1.0.7/purify.min.js"></script>

<!-- Your main JavaScript comes next -->
<script src="js/main.js"></script>
```

Once you have installed DOMPurify, you will be able to use a variable called `DOMPurify`. To sanitize your code, you use a `sanitize` method.

```js
form.addEventListener('submit', event => {
  // ...
  output.innerHTML = DOMPurify.sanitize(value)
})
```

If you try adding `<img src="x" onerror=alert("HACKED!")>` to the input box, nothing will show up.

<figure>
  <img src="/images/2018/" alt="">
  <figcaption></figcaption>
</figure>

But if you look in the DOM, you'll see an `<img>` tag with an `src` attribute that points to `x`. The `<img>` tag is present, but the `onerror` attribute is missing. DOMPurify removed it.

<figure>
  <img src="/images/2018/" alt="">
  <figcaption></figcaption>
</figure>

## Exercise

Sanitize the following strings. What are their sanitized outputs?

1. 123
2. 123
3. 123
4. 123
5. 123

Note: You can learn more about Cross site scripting here https://excess-xss.com.